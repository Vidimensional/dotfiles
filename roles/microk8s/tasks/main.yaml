---
- name: Install microk8s
  community.general.snap:
    name: microk8s

- name: Add user to microk8s group.
  ansible.builtin.user:
    name: "{{ caller_user.stdout }}"
    groups: microk8s
    append: true
    state: present
  become: true

- name: Install wrappers
  ansible.builtin.copy:
    src: "{{ item }}"
    dest: "/usr/local/bin/{{ item }}"
    owner: "{{ caller_user.stdout }}"
    group: "{{ caller_group.stdout }}"
    mode: u=xrw,g=r,o=r
  become: true
  loop:
    - helm3
    - kubectl
