---
- name: Configure laptop
  hosts: localhost
  connection: local

  vars:
    tmp_path: /tmp/dotfiles
    go_version: 'go1.19.4'

  tasks:
    - name: Get caller effective user
      ansible.builtin.command:
        cmd: id -nu
      register: caller_user
      changed_when: false

    - name: Get caller effective group
      ansible.builtin.command:
        cmd: id -ng
      register: caller_group
      changed_when: false

    - name: Create tmp path for working
      ansible.builtin.file:
        path: "{{ tmp_path }}/"
        state: directory
        mode: u=rwx,g=rx,o=rx

    - name: apt update # noqa name (https://ansible-lint.readthedocs.io/rules/name/)
      ansible.builtin.apt:
        update_cache: true
      become: true
      changed_when: false

    - name: apt upgrade # noqa name (https://ansible-lint.readthedocs.io/rules/name/)
      ansible.builtin.apt:
        upgrade: full
      become: true


    - name: Install & upgrade pip packages
      ansible.builtin.pip:
        name:
          - ansible
          - ansible-lint
          - awscli
          - pip
          - virtualenv
        state: latest # noqa package-latest (https://ansible-lint.readthedocs.io/rules/package-latest/)
        extra_args: --user

    - name: Install snap packages
      community.general.snap:
        name:
          - code
          - pycharm-community
          - slack

    - name: Install Holaluz's OpenVPN
      ansible.builtin.include_role:
        name: openvpn
      vars:
        holaluz_openvpn_config_path: /etc/openvpn/holaluz

    # - name: Install Zoom
    #   ansible.builtin.include_role:
    #     name: zoom

    - name: Install Docker
      ansible.builtin.include_role:
        name: docker
      vars:
        user: '{{ caller_user.stdout }}'

    - name: Install git
      ansible.builtin.include_role:
        name: git

    - name: Install Go
      ansible.builtin.include_role:
        name: go
      vars:
        version: "{{ go_version }}"

    - name: Configure Bash
      ansible.builtin.include_role:
        name: bashrc
