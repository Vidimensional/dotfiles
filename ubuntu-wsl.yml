---
- name: Configure WSL (Ubuntu 22.04)
  hosts: localhost
  connection: local

  vars:
    github_token: !vault |
          $ANSIBLE_VAULT;1.1;AES256
          61633366363435646566623363666363656337636633313537653430656361653137626366666233
          6532666637346133366338353930613532306665613730330a666139393133303562326239353731
          61333534613364303034376562633134396133623037663635356531303731313931663061343962
          3232613863306536390a633066303932623363303964326263363463643138306636623733623937
          34643230386563363331323265633432376436643337353837366163363136666162663036623138
          6565306234343861323161386136303835663862653734336364
    tmp_path: /tmp/dotfiles

  pre_tasks:
    - name: Create tmp path for working
      ansible.builtin.file:
        path: "{{ tmp_path }}/"
        state: directory
        mode: u=rwx,g=rx,o=rx

  roles:
    - name: Base bash configuration.
      role: bashrc

    - name: Install & upgrade packages.
      role: install_packages
      vars:
        install_packages_apt:
          - curl
          - jq
          - python3-full
          - python3-pip
          - tree
        install_packages_pip:
          - ansible
          - ansible-lint
          - black
          - pre-commit
          - virtualenv

    - name: Install Git.
      role: git

    - name: Install AWS CLI.
      role: awscli
      vars:
        awscli_version: "{{ lookup('vidimensional.collection.github_release', repo='aws/aws-cli', token=github_token) }}"
        install_ssm_plugin: true
        ssm_plugin_version: "{{ lookup('vidimensional.collection.github_release', repo='aws/session-manager-plugin', token=github_token) }}"

    - name: Install Go.
      role: go
      vars:
        version: "go{{ lookup('vidimensional.collection.github_release', repo='golang/go', token=github_token) }}"

    - name: Install Terraform.
      role: terraform
      vars:
        tfenv_version: "v{{ lookup('vidimensional.collection.github_release', repo='tfutils/tfenv', token=github_token) }}"
        terraform_use_version: "{{ lookup('vidimensional.collection.github_release', repo='hashicorp/terraform', token=github_token) }}"
